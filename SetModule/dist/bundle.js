(()=>{"use strict";class e{constructor(e,t,n,r){this.templateElement=document.getElementById(e),this.hostElement=document.getElementById(t);const s=document.importNode(this.templateElement.content,!0);this.element=s.firstElementChild,r&&(this.element.id=r),this.attach(n)}attach(e){this.hostElement.insertAdjacentElement(e?"afterbegin":"beforeend",this.element)}}function t(e){let t=!0;return e.required&&(t=t&&0!==e.value.toString().trim().length),null!=e.minlength&&"string"==typeof e.value&&(t=t&&e.value.length>=e.minlength),null!=e.maxlength&&"string"==typeof e.value&&(t=t&&e.value.length<=e.maxlength),null!=e.min&&"number"==typeof e.value&&(t=t&&e.value>=e.min),null!=e.max&&"number"==typeof e.value&&(t=t&&e.value<=e.max),t}function n(e,t,n){const r=n.value;return{configurable:!0,get(){return r.bind(this)}}}var r;!function(e){e[e.Active=0]="Active",e[e.Finished=1]="Finished"}(r||(r={}));class s{constructor(e,t,n,r,s){this.id=e,this.title=t,this.description=n,this.manday=r,this.status=s}}class i{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}}class a extends i{constructor(){super(),this.projects=[]}static getInstance(){return this.instance||(this.instance=new a),this.instance}addProject(e,t,n){const i=new s(Math.random().toString(),e,t,n,r.Active);this.projects.push(i),this.updateListeners()}moveProject(e,t){const n=this.projects.find((t=>t.id===e));n&&n.status!==t&&(n.status=t,this.updateListeners())}updateListeners(){for(const e of this.listeners)e(this.projects.slice())}}const o=a.getInstance();class l extends e{constructor(){super("project-input","app",!0,"user-input"),this.titleFormElement=this.element.querySelector("#title"),this.descriptionFormElement=this.element.querySelector("#description"),this.mandayFormElement=this.element.querySelector("#manday"),this.configure()}renderContent(){}configure(){this.element.addEventListener("submit",this.submitHandler)}gatherMethodInput(){const e=this.titleFormElement.value,n=this.descriptionFormElement.value,r=this.mandayFormElement.value,s={value:n,required:!0,minlength:5,maxlength:100},i={value:r,required:!0,min:0,max:100};return t({value:e,required:!0})&&t(s)&&t(i)?[e,n,+r]:void alert("入力値が誤っています")}submitHandler(e){e.preventDefault();const t=this.gatherMethodInput();if(Array.isArray(t)){const[e,n,r]=t;o.addProject(e,n,r),this.clearInput()}}clearInput(){this.titleFormElement.value="",this.descriptionFormElement.value="",this.mandayFormElement.value=""}}!function(e,t,n,r){var s,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(i<3?s(a):i>3?s(t,n,a):s(t,n))||a);i>3&&a&&Object.defineProperty(t,n,a)}([n],l.prototype,"submitHandler",null);class c extends e{get manday(){return this.project.manday<20?this.project.manday.toString()+"人日":(this.project.manday/20).toString()+"人月"}constructor(e,t){super("single-project",e,!1,t.id),this.project=t,this.configure(),this.renderContent()}dragStartHandler(e){e.dataTransfer.setData("text/plain",this.project.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){console.log(e,"Drag終了")}configure(){this.element.addEventListener("dragstart",this.dragStartHandler),this.element.addEventListener("dragend",this.dragEndHandler)}renderContent(){this.element.querySelector("h2").textContent=this.project.title,this.element.querySelector("h3").textContent=this.manday,this.element.querySelector("p").textContent=this.project.description}}!function(e,t,n,r){var s,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(i<3?s(a):i>3?s(t,n,a):s(t,n))||a);i>3&&a&&Object.defineProperty(t,n,a)}([n],c.prototype,"dragStartHandler",null);var d=function(e,t,n,r){var s,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(i<3?s(a):i>3?s(t,n,a):s(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};class h extends e{constructor(e){super("project-list","app",!1,`${e}-projects`),this.type=e,this.assignedProjects=[],this.configure(),this.renderContent()}dragOverHandler(e){e.dataTransfer&&"text/plain"===e.dataTransfer.types[0]&&(e.preventDefault(),this.element.querySelector("ul").classList.add("droppable"))}dropHandler(e){const t=e.dataTransfer.getData("text/plain");o.moveProject(t,"active"===this.type?r.Active:r.Finished)}dragLeaveHandler(e){this.element.querySelector("ul").classList.remove("droppable")}renderContent(){const e=`${this.type}-projects-list`;this.element.querySelector("ul").id=e,this.element.querySelector("h2").textContent="active"===this.type?"実行中プロジェクト":"完了プロジェクト"}configure(){this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("drop",this.dropHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),o.addListener((e=>{const t=e.filter((e=>"active"===this.type?e.status===r.Active:e.status===r.Finished));this.assignedProjects=t,this.renderProjects()}))}renderProjects(){const e=document.getElementById(`${this.type}-projects-list`);e.innerHTML="";for(const t of this.assignedProjects)new c(e.id,t)}}d([n],h.prototype,"dragOverHandler",null),d([n],h.prototype,"dropHandler",null),d([n],h.prototype,"dragLeaveHandler",null),new l,new h("active"),new h("finished")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZS1jb21wb25lbnQudHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZy10cy8uL3NyYy91dGlsL3ZhbGlkYXRpb24udHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZy10cy8uL3NyYy9kZWNvbGF0b3JzL2F1dG9iaW5kLnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHMvLi9zcmMvbW9kZWxzL3Byb2plY3QudHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZy10cy8uL3NyYy9zdGF0ZS9wcm9qZWN0LXN0YXRlLnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHMvLi9zcmMvY29tcG9uZW50cy9wcm9qZWN0LWlucHV0LnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHMvLi9zcmMvY29tcG9uZW50cy9wcm9qZWN0LWl0ZW0udHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZy10cy8uL3NyYy9jb21wb25lbnRzL3Byb2plY3QtbGlzdC50cyIsIndlYnBhY2s6Ly91bmRlcnN0YW5kaW5nLXRzLy4vc3JjL2FwcC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb21wb25lbnQgQ2xhc3NcbmV4cG9ydCBkZWZhdWx0IGFic3RyYWN0IGNsYXNzIENvbXBvbmVudDxcbiAgVCBleHRlbmRzIEhUTUxFbGVtZW50LFxuICBVIGV4dGVuZHMgSFRNTEVsZW1lbnRcbj4ge1xuICB0ZW1wbGF0ZUVsZW1lbnQ6IEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XG4gIGhvc3RFbGVtZW50OiBUO1xuICBlbGVtZW50OiBVO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHRlbXBsYXRlSWQ6IHN0cmluZyxcbiAgICBob3NFbGVtZW50SWQ6IHN0cmluZyxcbiAgICBpbnNlcnRBdFN0YXJ0OiBib29sZWFuLFxuICAgIG5ld0VsZW1lbnRJZD86IHN0cmluZ1xuICApIHtcbiAgICB0aGlzLnRlbXBsYXRlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuICAgICAgdGVtcGxhdGVJZFxuICAgICkhIGFzIEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XG4gICAgdGhpcy5ob3N0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGhvc0VsZW1lbnRJZCkhIGFzIFQ7XG4gICAgY29uc3QgaW1wb3J0ZWROb2RlID0gZG9jdW1lbnQuaW1wb3J0Tm9kZShcbiAgICAgIHRoaXMudGVtcGxhdGVFbGVtZW50LmNvbnRlbnQsXG4gICAgICB0cnVlXG4gICAgKTtcbiAgICB0aGlzLmVsZW1lbnQgPSBpbXBvcnRlZE5vZGUuZmlyc3RFbGVtZW50Q2hpbGQgYXMgVTtcbiAgICBpZiAobmV3RWxlbWVudElkKSB7XG4gICAgICB0aGlzLmVsZW1lbnQuaWQgPSBuZXdFbGVtZW50SWQ7XG4gICAgfVxuXG4gICAgdGhpcy5hdHRhY2goaW5zZXJ0QXRTdGFydCk7XG4gIH1cbiAgYWJzdHJhY3QgY29uZmlndXJlKCk6IHZvaWQ7XG4gIGFic3RyYWN0IHJlbmRlckNvbnRlbnQoKTogdm9pZDtcblxuICBwcml2YXRlIGF0dGFjaChpbnNlcnRBdEJlZ2lubmluZzogYm9vbGVhbikge1xuICAgIHRoaXMuaG9zdEVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KFxuICAgICAgaW5zZXJ0QXRCZWdpbm5pbmcgPyBcImFmdGVyYmVnaW5cIiA6IFwiYmVmb3JlZW5kXCIsXG4gICAgICB0aGlzLmVsZW1lbnRcbiAgICApO1xuICB9XG59XG4iLCIvLyBWYWxpZGF0aW9uXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRhYmxlIHtcbiAgdmFsdWU6IHN0cmluZyB8IG51bWJlcjtcbiAgcmVxdWlyZWQ/OiBib29sZWFuO1xuICBtaW5sZW5ndGg/OiBudW1iZXI7XG4gIG1heGxlbmd0aD86IG51bWJlcjtcbiAgbWluPzogbnVtYmVyO1xuICBtYXg/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZSh2YWxpZGF0YWJsZUlucHV0OiBWYWxpZGF0YWJsZSkge1xuICBsZXQgaXNWYWxpZCA9IHRydWU7XG4gIGlmICh2YWxpZGF0YWJsZUlucHV0LnJlcXVpcmVkKSB7XG4gICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZS50b1N0cmluZygpLnRyaW0oKS5sZW5ndGggIT09IDA7XG4gIH1cbiAgaWYgKFxuICAgIHZhbGlkYXRhYmxlSW5wdXQubWlubGVuZ3RoICE9IG51bGwgJiZcbiAgICB0eXBlb2YgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA9PT0gXCJzdHJpbmdcIlxuICApIHtcbiAgICBpc1ZhbGlkID1cbiAgICAgIGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZS5sZW5ndGggPj0gdmFsaWRhdGFibGVJbnB1dC5taW5sZW5ndGg7XG4gIH1cbiAgaWYgKFxuICAgIHZhbGlkYXRhYmxlSW5wdXQubWF4bGVuZ3RoICE9IG51bGwgJiZcbiAgICB0eXBlb2YgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA9PT0gXCJzdHJpbmdcIlxuICApIHtcbiAgICBpc1ZhbGlkID1cbiAgICAgIGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZS5sZW5ndGggPD0gdmFsaWRhdGFibGVJbnB1dC5tYXhsZW5ndGg7XG4gIH1cbiAgaWYgKFxuICAgIHZhbGlkYXRhYmxlSW5wdXQubWluICE9IG51bGwgJiZcbiAgICB0eXBlb2YgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA9PT0gXCJudW1iZXJcIlxuICApIHtcbiAgICBpc1ZhbGlkID0gaXNWYWxpZCAmJiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID49IHZhbGlkYXRhYmxlSW5wdXQubWluO1xuICB9XG4gIGlmIChcbiAgICB2YWxpZGF0YWJsZUlucHV0Lm1heCAhPSBudWxsICYmXG4gICAgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09IFwibnVtYmVyXCJcbiAgKSB7XG4gICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA8PSB2YWxpZGF0YWJsZUlucHV0Lm1heDtcbiAgfVxuXG4gIHJldHVybiBpc1ZhbGlkO1xufVxuIiwiLy8gYXV0b2JpbmQgZGVjb3JhdG9yKGJpbmTjg6Hjgr3jg4Pjg4njga7nnIHnlaUpXG5leHBvcnQgZnVuY3Rpb24gYXV0b2JpbmQoXzogYW55LCBfMjogc3RyaW5nLCBkZXNjcmlwdG9yOiBQcm9wZXJ0eURlc2NyaXB0b3IpIHtcbiAgY29uc3Qgb3JpZ2luYWxNZXRob2QgPSBkZXNjcmlwdG9yLnZhbHVlO1xuICBjb25zdCBhZGpEZXNjcmlwdG9yOiBQcm9wZXJ0eURlc2NyaXB0b3IgPSB7XG4gICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgIGdldCgpIHtcbiAgICAgIGNvbnN0IGJvdW5kRm4gPSBvcmlnaW5hbE1ldGhvZC5iaW5kKHRoaXMpO1xuICAgICAgcmV0dXJuIGJvdW5kRm47XG4gICAgfSxcbiAgfTtcbiAgcmV0dXJuIGFkakRlc2NyaXB0b3I7XG59XG4iLCIvLyBQcm9qZWN0IFR5cGVcbmV4cG9ydCBlbnVtIFByb2plY3RTdGF0dXMge1xuICBBY3RpdmUsXG4gIEZpbmlzaGVkLFxufVxuZXhwb3J0IGNsYXNzIFByb2plY3Qge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgaWQ6IHN0cmluZyxcbiAgICBwdWJsaWMgdGl0bGU6IHN0cmluZyxcbiAgICBwdWJsaWMgZGVzY3JpcHRpb246IHN0cmluZyxcbiAgICBwdWJsaWMgbWFuZGF5OiBudW1iZXIsXG4gICAgcHVibGljIHN0YXR1czogUHJvamVjdFN0YXR1c1xuICApIHt9XG59XG4iLCJpbXBvcnQgeyBQcm9qZWN0IH0gZnJvbSBcIi4uL21vZGVscy9wcm9qZWN0XCI7XG5pbXBvcnQgeyBQcm9qZWN0U3RhdHVzIH0gZnJvbSBcIi4uL21vZGVscy9wcm9qZWN0XCI7XG5cbi8vIFByb2plY3QgU3RhdGUgTWFuYWdlbWVudFxudHlwZSBMaXN0ZW5lcjxUPiA9IChpdGVtczogVFtdKSA9PiB2b2lkO1xuXG5jbGFzcyBTdGF0ZTxUPiB7XG4gIHByb3RlY3RlZCBsaXN0ZW5lcnM6IExpc3RlbmVyPFQ+W10gPSBbXTtcblxuICBhZGRMaXN0ZW5lcihsaXN0ZW5lckZuOiBMaXN0ZW5lcjxUPikge1xuICAgIHRoaXMubGlzdGVuZXJzLnB1c2gobGlzdGVuZXJGbik7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFByb2plY3RTdGF0ZSBleHRlbmRzIFN0YXRlPFByb2plY3Q+IHtcbiAgcHJpdmF0ZSBwcm9qZWN0czogUHJvamVjdFtdID0gW107XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBQcm9qZWN0U3RhdGU7XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgc3RhdGljIGdldEluc3RhbmNlKCkge1xuICAgIGlmICghdGhpcy5pbnN0YW5jZSkge1xuICAgICAgdGhpcy5pbnN0YW5jZSA9IG5ldyBQcm9qZWN0U3RhdGUoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XG4gIH1cblxuICBhZGRQcm9qZWN0KHRpdGxlOiBzdHJpbmcsIGRlc2NyaXB0aW9uOiBzdHJpbmcsIG1hbmRheTogbnVtYmVyKSB7XG4gICAgY29uc3QgbmV3UHJvamVjdCA9IG5ldyBQcm9qZWN0KFxuICAgICAgTWF0aC5yYW5kb20oKS50b1N0cmluZygpLFxuICAgICAgdGl0bGUsXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIG1hbmRheSxcbiAgICAgIFByb2plY3RTdGF0dXMuQWN0aXZlXG4gICAgKTtcblxuICAgIHRoaXMucHJvamVjdHMucHVzaChuZXdQcm9qZWN0KTtcbiAgICB0aGlzLnVwZGF0ZUxpc3RlbmVycygpO1xuICB9XG5cbiAgbW92ZVByb2plY3QocHJvamVjdElkOiBzdHJpbmcsIG5ld1N0YXR1czogUHJvamVjdFN0YXR1cykge1xuICAgIGNvbnN0IHByb2plY3QgPSB0aGlzLnByb2plY3RzLmZpbmQoKHBqKSA9PiBwai5pZCA9PT0gcHJvamVjdElkKTtcbiAgICBpZiAocHJvamVjdCAmJiBwcm9qZWN0LnN0YXR1cyAhPT0gbmV3U3RhdHVzKSB7XG4gICAgICBwcm9qZWN0LnN0YXR1cyA9IG5ld1N0YXR1cztcbiAgICAgIHRoaXMudXBkYXRlTGlzdGVuZXJzKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVMaXN0ZW5lcnMoKSB7XG4gICAgZm9yIChjb25zdCBsaW5zdGVyRm4gb2YgdGhpcy5saXN0ZW5lcnMpIHtcbiAgICAgIGxpbnN0ZXJGbih0aGlzLnByb2plY3RzLnNsaWNlKCkpO1xuICAgIH1cbiAgfVxufVxuZXhwb3J0IGNvbnN0IHBqU3RhdGUgPSBQcm9qZWN0U3RhdGUuZ2V0SW5zdGFuY2UoKTtcbiIsImltcG9ydCBDb21wb25lbnQgZnJvbSBcIi4vYmFzZS1jb21wb25lbnRcIjtcbmltcG9ydCAqIGFzIFZhbGlkYXRpb24gZnJvbSBcIi4uL3V0aWwvdmFsaWRhdGlvblwiO1xuaW1wb3J0IHsgYXV0b2JpbmQgfSBmcm9tIFwiLi4vZGVjb2xhdG9ycy9hdXRvYmluZFwiO1xuaW1wb3J0IHsgcGpTdGF0ZSB9IGZyb20gXCIuLi9zdGF0ZS9wcm9qZWN0LXN0YXRlXCI7XG5cbmV4cG9ydCBjbGFzcyBQcm9qZWN0SW5wdXQgZXh0ZW5kcyBDb21wb25lbnQ8SFRNTERpdkVsZW1lbnQsIEhUTUxGb3JtRWxlbWVudD4ge1xuICB0aXRsZUZvcm1FbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuICBkZXNjcmlwdGlvbkZvcm1FbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuICBtYW5kYXlGb3JtRWxlbWVudDogSFRNTElucHV0RWxlbWVudDtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcihcInByb2plY3QtaW5wdXRcIiwgXCJhcHBcIiwgdHJ1ZSwgXCJ1c2VyLWlucHV0XCIpO1xuXG4gICAgdGhpcy50aXRsZUZvcm1FbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIiN0aXRsZVwiXG4gICAgKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIHRoaXMuZGVzY3JpcHRpb25Gb3JtRWxlbWVudCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIjZGVzY3JpcHRpb25cIlxuICAgICkgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICB0aGlzLm1hbmRheUZvcm1FbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIiNtYW5kYXlcIlxuICAgICkgYXMgSFRNTElucHV0RWxlbWVudDtcblxuICAgIHRoaXMuY29uZmlndXJlKCk7XG4gIH1cblxuICByZW5kZXJDb250ZW50KCk6IHZvaWQge31cblxuICBjb25maWd1cmUoKSB7XG4gICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5zdWJtaXRIYW5kbGVyKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2F0aGVyTWV0aG9kSW5wdXQoKTogW3N0cmluZywgc3RyaW5nLCBudW1iZXJdIHwgdm9pZCB7XG4gICAgY29uc3QgZW50ZXJlZFRpdGxlID0gdGhpcy50aXRsZUZvcm1FbGVtZW50LnZhbHVlO1xuICAgIGNvbnN0IGVudGVyZWREZXNjcml0aW9uID0gdGhpcy5kZXNjcmlwdGlvbkZvcm1FbGVtZW50LnZhbHVlO1xuICAgIGNvbnN0IGVudGVyZWRNYW5kYXkgPSB0aGlzLm1hbmRheUZvcm1FbGVtZW50LnZhbHVlO1xuXG4gICAgY29uc3QgdGl0bGVWYWxpZGF0YWJsZTogVmFsaWRhdGlvbi5WYWxpZGF0YWJsZSA9IHtcbiAgICAgIHZhbHVlOiBlbnRlcmVkVGl0bGUsXG4gICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICB9O1xuICAgIGNvbnN0IGRlc2NyaXRpb25WYWxpZGF0YWJsZTogVmFsaWRhdGlvbi5WYWxpZGF0YWJsZSA9IHtcbiAgICAgIHZhbHVlOiBlbnRlcmVkRGVzY3JpdGlvbixcbiAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgbWlubGVuZ3RoOiA1LFxuICAgICAgbWF4bGVuZ3RoOiAxMDAsXG4gICAgfTtcbiAgICBjb25zdCBtYW5kYXlWYWxpZGF0YWJsZTogVmFsaWRhdGlvbi5WYWxpZGF0YWJsZSA9IHtcbiAgICAgIHZhbHVlOiBlbnRlcmVkTWFuZGF5LFxuICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICBtaW46IDAsXG4gICAgICBtYXg6IDEwMCxcbiAgICB9O1xuICAgIGlmIChcbiAgICAgICFWYWxpZGF0aW9uLnZhbGlkYXRlKHRpdGxlVmFsaWRhdGFibGUpIHx8XG4gICAgICAhVmFsaWRhdGlvbi52YWxpZGF0ZShkZXNjcml0aW9uVmFsaWRhdGFibGUpIHx8XG4gICAgICAhVmFsaWRhdGlvbi52YWxpZGF0ZShtYW5kYXlWYWxpZGF0YWJsZSlcbiAgICApIHtcbiAgICAgIGFsZXJ0KFwi5YWl5Yqb5YCk44GM6Kqk44Gj44Gm44GE44G+44GZXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gW2VudGVyZWRUaXRsZSwgZW50ZXJlZERlc2NyaXRpb24sICtlbnRlcmVkTWFuZGF5XTtcbiAgICB9XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgcHJpdmF0ZSBzdWJtaXRIYW5kbGVyKGU6IEV2ZW50KSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHVzZXJJbnB1dCA9IHRoaXMuZ2F0aGVyTWV0aG9kSW5wdXQoKTtcbiAgICBpZiAoQXJyYXkuaXNBcnJheSh1c2VySW5wdXQpKSB7XG4gICAgICBjb25zdCBbdGl0bGUsIGRlc2MsIG1hbmRheV0gPSB1c2VySW5wdXQ7XG4gICAgICBwalN0YXRlLmFkZFByb2plY3QodGl0bGUsIGRlc2MsIG1hbmRheSk7XG4gICAgICB0aGlzLmNsZWFySW5wdXQoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNsZWFySW5wdXQoKSB7XG4gICAgdGhpcy50aXRsZUZvcm1FbGVtZW50LnZhbHVlID0gXCJcIjtcbiAgICB0aGlzLmRlc2NyaXB0aW9uRm9ybUVsZW1lbnQudmFsdWUgPSBcIlwiO1xuICAgIHRoaXMubWFuZGF5Rm9ybUVsZW1lbnQudmFsdWUgPSBcIlwiO1xuICB9XG59XG4iLCJpbXBvcnQgeyBEcmFnZ2FibGUgfSBmcm9tIFwiLi4vbW9kZWxzL2RyYWctZHJvcFwiO1xuaW1wb3J0IENvbXBvbmVudCBmcm9tIFwiLi9iYXNlLWNvbXBvbmVudFwiO1xuaW1wb3J0IHsgUHJvamVjdCB9IGZyb20gXCIuLi9tb2RlbHMvcHJvamVjdFwiO1xuaW1wb3J0IHsgYXV0b2JpbmQgfSBmcm9tIFwiLi4vZGVjb2xhdG9ycy9hdXRvYmluZFwiO1xuXG5leHBvcnQgY2xhc3MgUHJvamVjdEl0ZW1cbiAgZXh0ZW5kcyBDb21wb25lbnQ8SFRNTFVMaXN0RWxlbWVudCwgSFRNTExJRWxlbWVudD5cbiAgaW1wbGVtZW50cyBEcmFnZ2FibGVcbntcbiAgcHJpdmF0ZSBwcm9qZWN0OiBQcm9qZWN0O1xuXG4gIGdldCBtYW5kYXkoKSB7XG4gICAgaWYgKHRoaXMucHJvamVjdC5tYW5kYXkgPCAyMCkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvamVjdC5tYW5kYXkudG9TdHJpbmcoKSArIFwi5Lq65pelXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAodGhpcy5wcm9qZWN0Lm1hbmRheSAvIDIwKS50b1N0cmluZygpICsgXCLkurrmnIhcIjtcbiAgICB9XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihob3N0SWQ6IHN0cmluZywgcHJvamVjdDogUHJvamVjdCkge1xuICAgIHN1cGVyKFwic2luZ2xlLXByb2plY3RcIiwgaG9zdElkLCBmYWxzZSwgcHJvamVjdC5pZCk7XG4gICAgdGhpcy5wcm9qZWN0ID0gcHJvamVjdDtcblxuICAgIHRoaXMuY29uZmlndXJlKCk7XG4gICAgdGhpcy5yZW5kZXJDb250ZW50KCk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgZHJhZ1N0YXJ0SGFuZGxlcihlOiBEcmFnRXZlbnQpOiB2b2lkIHtcbiAgICBlLmRhdGFUcmFuc2ZlciEuc2V0RGF0YShcInRleHQvcGxhaW5cIiwgdGhpcy5wcm9qZWN0LmlkKTtcbiAgICBlLmRhdGFUcmFuc2ZlciEuZWZmZWN0QWxsb3dlZCA9IFwibW92ZVwiO1xuICB9XG4gIGRyYWdFbmRIYW5kbGVyKGU6IERyYWdFdmVudCk6IHZvaWQge1xuICAgIGNvbnNvbGUubG9nKGUsIFwiRHJhZ+e1guS6hlwiKTtcbiAgfVxuXG4gIGNvbmZpZ3VyZSgpOiB2b2lkIHtcbiAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdzdGFydFwiLCB0aGlzLmRyYWdTdGFydEhhbmRsZXIpO1xuICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ2VuZFwiLCB0aGlzLmRyYWdFbmRIYW5kbGVyKTtcbiAgfVxuICByZW5kZXJDb250ZW50KCk6IHZvaWQge1xuICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiaDJcIikhLnRleHRDb250ZW50ID0gdGhpcy5wcm9qZWN0LnRpdGxlO1xuICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiaDNcIikhLnRleHRDb250ZW50ID0gdGhpcy5tYW5kYXk7XG4gICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJwXCIpIS50ZXh0Q29udGVudCA9IHRoaXMucHJvamVjdC5kZXNjcmlwdGlvbjtcbiAgfVxufVxuIiwiaW1wb3J0IENvbXBvbmVudCBmcm9tIFwiLi9iYXNlLWNvbXBvbmVudFwiO1xuaW1wb3J0IHsgRHJhZ1RhcmdldCB9IGZyb20gXCIuLi9tb2RlbHMvZHJhZy1kcm9wXCI7XG5pbXBvcnQgeyBQcm9qZWN0LCBQcm9qZWN0U3RhdHVzIH0gZnJvbSBcIi4uL21vZGVscy9wcm9qZWN0XCI7XG5pbXBvcnQgeyBhdXRvYmluZCB9IGZyb20gXCIuLi9kZWNvbGF0b3JzL2F1dG9iaW5kXCI7XG5pbXBvcnQgeyBwalN0YXRlIH0gZnJvbSBcIi4uL3N0YXRlL3Byb2plY3Qtc3RhdGVcIjtcbmltcG9ydCB7IFByb2plY3RJdGVtIH0gZnJvbSBcIi4vcHJvamVjdC1pdGVtXCI7XG5cbmV4cG9ydCBjbGFzcyBQcm9qZWN0TGlzdFxuICBleHRlbmRzIENvbXBvbmVudDxIVE1MRGl2RWxlbWVudCwgSFRNTEVsZW1lbnQ+XG4gIGltcGxlbWVudHMgRHJhZ1RhcmdldFxue1xuICBhc3NpZ25lZFByb2plY3RzOiBQcm9qZWN0W107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSB0eXBlOiBcImFjdGl2ZVwiIHwgXCJmaW5pc2hlZFwiKSB7XG4gICAgc3VwZXIoXCJwcm9qZWN0LWxpc3RcIiwgXCJhcHBcIiwgZmFsc2UsIGAke3R5cGV9LXByb2plY3RzYCk7XG4gICAgdGhpcy5hc3NpZ25lZFByb2plY3RzID0gW107XG5cbiAgICB0aGlzLmNvbmZpZ3VyZSgpO1xuICAgIHRoaXMucmVuZGVyQ29udGVudCgpO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIGRyYWdPdmVySGFuZGxlcihlOiBEcmFnRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAoZS5kYXRhVHJhbnNmZXIgJiYgZS5kYXRhVHJhbnNmZXIudHlwZXNbMF0gPT09IFwidGV4dC9wbGFpblwiKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBjb25zdCBsaXN0RWwgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcInVsXCIpITtcbiAgICAgIGxpc3RFbC5jbGFzc0xpc3QuYWRkKFwiZHJvcHBhYmxlXCIpO1xuICAgIH1cbiAgfVxuXG4gIEBhdXRvYmluZFxuICBkcm9wSGFuZGxlcihlOiBEcmFnRXZlbnQpOiB2b2lkIHtcbiAgICBjb25zdCBwaklkID0gZS5kYXRhVHJhbnNmZXIhLmdldERhdGEoXCJ0ZXh0L3BsYWluXCIpO1xuICAgIHBqU3RhdGUubW92ZVByb2plY3QoXG4gICAgICBwaklkLFxuICAgICAgdGhpcy50eXBlID09PSBcImFjdGl2ZVwiID8gUHJvamVjdFN0YXR1cy5BY3RpdmUgOiBQcm9qZWN0U3RhdHVzLkZpbmlzaGVkXG4gICAgKTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBkcmFnTGVhdmVIYW5kbGVyKF86IERyYWdFdmVudCk6IHZvaWQge1xuICAgIGNvbnN0IGxpc3RFbCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwidWxcIikhO1xuICAgIGxpc3RFbC5jbGFzc0xpc3QucmVtb3ZlKFwiZHJvcHBhYmxlXCIpO1xuICB9XG5cbiAgcmVuZGVyQ29udGVudCgpIHtcbiAgICBjb25zdCBsaXN0SWQgPSBgJHt0aGlzLnR5cGV9LXByb2plY3RzLWxpc3RgO1xuICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwidWxcIikhLmlkID0gbGlzdElkO1xuICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiaDJcIikhLnRleHRDb250ZW50ID1cbiAgICAgIHRoaXMudHlwZSA9PT0gXCJhY3RpdmVcIiA/IFwi5a6f6KGM5Lit44OX44Ot44K444Kn44Kv44OIXCIgOiBcIuWujOS6huODl+ODreOCuOOCp+OCr+ODiFwiO1xuICB9XG5cbiAgY29uZmlndXJlKCk6IHZvaWQge1xuICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ292ZXJcIiwgdGhpcy5kcmFnT3ZlckhhbmRsZXIpO1xuICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJvcFwiLCB0aGlzLmRyb3BIYW5kbGVyKTtcbiAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdsZWF2ZVwiLCB0aGlzLmRyYWdMZWF2ZUhhbmRsZXIpO1xuICAgIHBqU3RhdGUuYWRkTGlzdGVuZXIoKHByb2plY3RzOiBQcm9qZWN0W10pID0+IHtcbiAgICAgIGNvbnN0IHJlbGV2YW50UHJvamVjdHMgPSBwcm9qZWN0cy5maWx0ZXIoKHByb2plY3QpID0+IHtcbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gXCJhY3RpdmVcIikge1xuICAgICAgICAgIHJldHVybiBwcm9qZWN0LnN0YXR1cyA9PT0gUHJvamVjdFN0YXR1cy5BY3RpdmU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHByb2plY3Quc3RhdHVzID09PSBQcm9qZWN0U3RhdHVzLkZpbmlzaGVkO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmFzc2lnbmVkUHJvamVjdHMgPSByZWxldmFudFByb2plY3RzO1xuICAgICAgdGhpcy5yZW5kZXJQcm9qZWN0cygpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJQcm9qZWN0cygpIHtcbiAgICBjb25zdCBsaXN0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcbiAgICAgIGAke3RoaXMudHlwZX0tcHJvamVjdHMtbGlzdGBcbiAgICApISBhcyBIVE1MVUxpc3RFbGVtZW50O1xuICAgIGxpc3RFbC5pbm5lckhUTUwgPSBcIlwiO1xuICAgIGZvciAoY29uc3QgcGpJdGVtIG9mIHRoaXMuYXNzaWduZWRQcm9qZWN0cykge1xuICAgICAgbmV3IFByb2plY3RJdGVtKGxpc3RFbC5pZCwgcGpJdGVtKTtcbiAgICB9XG4gIH1cbn1cbiIsImltcG9ydCB7IFByb2plY3RJbnB1dCB9IGZyb20gXCIuL2NvbXBvbmVudHMvcHJvamVjdC1pbnB1dFwiO1xuaW1wb3J0IHsgUHJvamVjdExpc3QgfSBmcm9tIFwiLi9jb21wb25lbnRzL3Byb2plY3QtbGlzdFwiO1xuXG5uZXcgUHJvamVjdElucHV0KCk7XG5uZXcgUHJvamVjdExpc3QoXCJhY3RpdmVcIik7XG5uZXcgUHJvamVjdExpc3QoXCJmaW5pc2hlZFwiKTtcbiJdLCJuYW1lcyI6WyJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInRlbXBsYXRlSWQiLCJob3NFbGVtZW50SWQiLCJpbnNlcnRBdFN0YXJ0IiwibmV3RWxlbWVudElkIiwidGhpcyIsInRlbXBsYXRlRWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJob3N0RWxlbWVudCIsImltcG9ydGVkTm9kZSIsImltcG9ydE5vZGUiLCJjb250ZW50IiwiZWxlbWVudCIsImZpcnN0RWxlbWVudENoaWxkIiwiaWQiLCJhdHRhY2giLCJpbnNlcnRBdEJlZ2lubmluZyIsImluc2VydEFkamFjZW50RWxlbWVudCIsInZhbGlkYXRlIiwidmFsaWRhdGFibGVJbnB1dCIsImlzVmFsaWQiLCJyZXF1aXJlZCIsInZhbHVlIiwidG9TdHJpbmciLCJ0cmltIiwibGVuZ3RoIiwibWlubGVuZ3RoIiwibWF4bGVuZ3RoIiwibWluIiwibWF4IiwiYXV0b2JpbmQiLCJfIiwiXzIiLCJkZXNjcmlwdG9yIiwib3JpZ2luYWxNZXRob2QiLCJjb25maWd1cmFibGUiLCJnZXQiLCJiaW5kIiwiUHJvamVjdFN0YXR1cyIsIlByb2plY3QiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwibWFuZGF5Iiwic3RhdHVzIiwiU3RhdGUiLCJsaXN0ZW5lcnMiLCJhZGRMaXN0ZW5lciIsImxpc3RlbmVyRm4iLCJwdXNoIiwiUHJvamVjdFN0YXRlIiwic3VwZXIiLCJwcm9qZWN0cyIsInN0YXRpYyIsImluc3RhbmNlIiwiYWRkUHJvamVjdCIsIm5ld1Byb2plY3QiLCJNYXRoIiwicmFuZG9tIiwiQWN0aXZlIiwidXBkYXRlTGlzdGVuZXJzIiwibW92ZVByb2plY3QiLCJwcm9qZWN0SWQiLCJuZXdTdGF0dXMiLCJwcm9qZWN0IiwiZmluZCIsInBqIiwibGluc3RlckZuIiwic2xpY2UiLCJwalN0YXRlIiwiZ2V0SW5zdGFuY2UiLCJQcm9qZWN0SW5wdXQiLCJ0aXRsZUZvcm1FbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImRlc2NyaXB0aW9uRm9ybUVsZW1lbnQiLCJtYW5kYXlGb3JtRWxlbWVudCIsImNvbmZpZ3VyZSIsInJlbmRlckNvbnRlbnQiLCJhZGRFdmVudExpc3RlbmVyIiwic3VibWl0SGFuZGxlciIsImdhdGhlck1ldGhvZElucHV0IiwiZW50ZXJlZFRpdGxlIiwiZW50ZXJlZERlc2NyaXRpb24iLCJlbnRlcmVkTWFuZGF5IiwiZGVzY3JpdGlvblZhbGlkYXRhYmxlIiwibWFuZGF5VmFsaWRhdGFibGUiLCJhbGVydCIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInVzZXJJbnB1dCIsIkFycmF5IiwiaXNBcnJheSIsImRlc2MiLCJjbGVhcklucHV0IiwiUHJvamVjdEl0ZW0iLCJob3N0SWQiLCJkcmFnU3RhcnRIYW5kbGVyIiwiZGF0YVRyYW5zZmVyIiwic2V0RGF0YSIsImVmZmVjdEFsbG93ZWQiLCJkcmFnRW5kSGFuZGxlciIsImNvbnNvbGUiLCJsb2ciLCJ0ZXh0Q29udGVudCIsIlByb2plY3RMaXN0IiwidHlwZSIsImFzc2lnbmVkUHJvamVjdHMiLCJkcmFnT3ZlckhhbmRsZXIiLCJ0eXBlcyIsImNsYXNzTGlzdCIsImFkZCIsImRyb3BIYW5kbGVyIiwicGpJZCIsImdldERhdGEiLCJGaW5pc2hlZCIsImRyYWdMZWF2ZUhhbmRsZXIiLCJyZW1vdmUiLCJsaXN0SWQiLCJyZWxldmFudFByb2plY3RzIiwiZmlsdGVyIiwicmVuZGVyUHJvamVjdHMiLCJsaXN0RWwiLCJpbm5lckhUTUwiLCJwakl0ZW0iXSwic291cmNlUm9vdCI6IiJ9